#æ¦‚è¦#
- class2apiå¸®åŠ©ä½ æŠŠJavascript Classç±»çš„é™æ€æ–¹æ³•è‡ªåŠ¨å‘å¤–æ˜ å°„ä¸ºAPIæ¥å£çš„å¾®å‹æ¡†æ¶ï¼Œå€ŸåŠ©class2apiï¼Œä½ å¯ä»¥åœ¨1åˆ†é’Ÿä¹‹å†…ç›´æ¥å¼€å§‹ç€æ‰‹äºä¸šåŠ¡é€»è¾‘ä»£ç çš„ç¼–å†™ï¼Œè€Œå°†è·¯ç”±ã€æ–¹æ³•ç¼“å­˜ã€ç½‘ç»œé€šè®¯ç­‰äº‹åŠ¡äº¤ç»™æˆ‘ä»¬å¤„ç†
- class2apiæš´éœ²çš„APIæ¥å£ä»…ä»¥postæ–¹å¼æä¾›è¯·æ±‚æœåŠ¡ï¼ˆæ³¨æ„ï¼šä¸æ”¯æŒgetç­‰å…¶ä»–æ–¹å¼ï¼ï¼‰
- ä½œä¸ºå¾®æœåŠ¡ï¼Œä½¿ç”¨å†…ç½®Expressæ—¶ï¼Œclass2apiä¸å¼€å¯sessinã€‚æ³¨ï¼šå½“ä½¿ç”¨createServerInRouteræŒ‚è½½åˆ°ç°æœ‰çš„Expressåº”ç”¨ä¸‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¿ä¸»Expressåº”ç”¨çš„sessionæœºåˆ¶


#ä¸Šæ‰‹å‘å¯¼#

- å¿«é€Ÿå®‰è£…ä¾èµ–ç»„å»º
```
$ npm i 
æˆ–
$ npm i --registry=https://registry.npm.taobao.org 
```

- åŸºäºæºç ç‰ˆæœ¬è¿è¡ŒDemoåº”ç”¨(Serverç‰ˆæœ¬)
```
$ npm run start:src 
```

- åŸºäºæºç ç‰ˆæœ¬è¿è¡ŒDemoåº”ç”¨(ExpressRouterè·¯ç”±ç‰ˆæœ¬)
```
$ npm run start:srcrouter
```

- è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆå…ˆè¿è¡ŒDemoåº”ç”¨ï¼‰
```
$ mocha test/test.run
```

#å¿«é€Ÿåˆ›å»ºåº”ç”¨çš„ä»£ç #

## åˆ›å»ºä¸€ä¸ªä¸šåŠ¡ç±»ClassA.js
```javascript
    class ClassA {
        static async hello({name}) {
            return {message: `this is a message from Api: got name [${name}]`}
        }
    } 
    export default ClassA
```

## åˆ›å»ºå¾®å¾®æœåŠ¡
```javascript
    import {createServer} from 'class2api'
    import ClassA from './ClassA'
    
    //åˆ›å»ºå¾®æœåŠ¡å¯¹è±¡
    createServer({
        modelClasses: [{model: ClassA, as: 'a'}],
        beforeCall:async ({req, params, modelSetting})=>{
            return params
        }
    }).then((server)=>{
        //å¼€å§‹ç›‘å¬æŒ‡å®šçš„ç«¯å£
        let port = 3002;
        server.listen(port, "0.0.0.0", function onStart(err){
            if (err) {
                console.log(err);
            }
            console.info("==> ğŸŒ Listening on port %s. Open up http://0.0.0.0:%s/ in your browser.", port, port);
        });
    }).catch((error)=>{
        setTimeout(function(){throw error})
    })
```


# å¯¼å‡ºåŠŸèƒ½å‡½æ•°ï¼š

## class2apiç©ºé—´
- createServer(opts)
åˆ›å»ºæœåŠ¡å™¨(ä½¿ç”¨å†…å»ºçš„ç‹¬ç«‹Expresså®ä¾‹) ,optsä¸ºå‚æ•°é¡¹ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
```javascript
    createServer({
        config:{
           apiroot:'/',//æŒ‚è½½å¾®æœåŠ¡çš„æ ¹è·¯å¾„ï¼Œå¦‚ï¼šapirootè®¾ç½®ä¸º'apiv1"ï¼Œåˆ™ä¸šåŠ¡ç±»ClassAçš„method1æ–¹æ³•å¯¹åº”çš„è®¿é—®å…¥å£ä¸º: http://yourdomain/apiv1/classa/method1
           redis,//å†…ç½®APIæ–¹æ³•ç¼“å­˜æ‰€ä½¿ç”¨çš„rediså®ä¾‹é…ç½®å‚æ•°ï¼Œä½¿ç”¨clearCacheã€cacheAbleä¿®é¥°å™¨æ—¶å¿…é¡»
           cros:true,//æ˜¯å¦å…è®¸è·¨åŸŸè®¿é—®
           cros_headers:[],//å…è®¸è·¨åŸŸè®¿é—®æ—¶çš„headersç™½åå•
           cros_origin:[],//å…è®¸è·¨åŸŸè®¿é—®æ—¶çš„æˆæƒæºé…ç½®ï¼Œé»˜è®¤ä¸º*ã€‚å½“ä¼ å…¥æœ‰æ•ˆçš„cros_originå‚æ•°æ—¶ï¼Œä»¥cros_originä¸­æŒ‡å®šçš„ä¸ºå‡†
           frontpage_default: '' //æ”¾åœ¨APIæ–¹æ³•å†…éƒ¨è·å–å‰ç«¯çš„åŸŸåï¼Œä¸ä»å‰ç«¯è¯·æ±‚ä¼ è¿‡æ¥headerä¸­çš„frontpageåˆå¹¶ï¼Œä¼˜å…ˆè·å–å®¢æˆ·ç«¯çš„ï¼Œå…¶å®é‡‡ç”¨æ­¤é»˜è®¤å€¼ã€‚æœ€åå°è£…ä¸ºæ ‡å‡†urlå¯¹è±¡å¹¶ç»‘å®šåˆ°APIæ–¹æ³•å›è°ƒçš„paramså¯¹è±¡çš„___frontpageURLå±æ€§ä¸Š
        }, 
        custom:(expressInstence)=>{
            //TODO:å¯¹expressInstenceå®ä¾‹è¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ï¼Œæ³¨ï¼šä¸å»ºè®®å¢åŠ sessionæœºåˆ¶
            return expressInstence
        },
        modelClasses, //æ˜ å°„çš„ä¸šåŠ¡ç±»åˆ—è¡¨ï¼Œå¦‚:[ClassA, {model:XXX,as:'abc'}]ï¼Œå»ºè®®ä»¥mode-asçš„æ–¹å¼ä¿®æ”¹ä¸šåŠ¡ç±»æš´éœ²çš„è®¿é—®è·¯å¾„ï¼Œä»¥éšè—å®é™…çš„ç±»å‘½åï¼ˆå»ºè®®ï¼‰
        beforeCall, //APIæ¥å£è¯·æ±‚ä¹‹å‰çš„æ‹¦æˆªäº‹ä»¶ï¼Œå¯ä»¥ä¿®æ”¹ã€ç›‘å¬postä¿¡æ¯ï¼Œä»¥åŠèº«ä»½çš„éªŒè¯åˆ¤æ–­
        afterCall, //APIæ¥å£è¯·æ±‚å®Œæˆåçš„æ‹¦æˆªäº‹ä»¶ï¼Œå¯ä»¥ä¿®æ”¹ã€ç›‘å¬è¿”å›ç»“æœï¼Œå…¸å‹åœºæ™¯å°±æ˜¯è®°å½•è¯·æ±‚çš„æ—¥å¿—
        method404//è‡ªå®šä¹‰çš„expressçš„è·¯ç”±ä¸­é—´ä»¶ï¼Œåœ¨404åœºæ™¯æ—¶ï¼Œå¯è¾“å‡ºè‡ªå·±å®šåˆ¶çš„è¿”å›å€¼
    })
```

- createServerInRouter(opts)
åˆ›å»ºæœåŠ¡å™¨(ä½¿ç”¨å¤–éƒ¨çš„Expressï¼Œåªè¿”å›routerä¾›ç»‘å®šè·¯ç”±)ï¼Œoptså‚æ•°ä¸createServerå‡½æ•°åŸºæœ¬ç›¸åŒï¼Œé™¤äº†è‡ªåŠ¨å¿½ç•¥customå‚æ•°

- setting_redisConfig
è®¾ç½®å†…ç½®redisçš„è¿æ¥å‚æ•°ï¼Œå› ä¸ºè€ƒè™‘åˆ°importå£°æ˜è‡ªåŠ¨æå‰çš„é—®é¢˜ï¼Œä¸ºç¡®ä¿å…¶ä»–è‡ªå®šä¹‰ä¸šåŠ¡ç±»å†…éƒ¨åˆå§‹åŒ–æ—¶ä¾èµ–rediså®ä¾‹çš„åœºæ™¯ã€‚å»ºè®®çš„ï¼Œæœ€ä½³æ–¹æ³•æ˜¯å®šä¹‰ä¸ªç‹¬ç«‹çš„init.jsï¼Œå¹¶åœ¨server.jsé¡¶éƒ¨ç¬¬ä¸€è¡Œå¼•ç”¨
```javascript
//init.js
import {setting_redisConfig} from 'class2api'
setting_redisConfig({
                        host: "127.0.0.1",
                        port: 6379,
                        cache_prefx:'dev_class2api_',//å¿…é¡»çš„å‚æ•°ï¼Œä¸”é’ˆå¯¹æ¯ä¸ªåº”ç”¨ä¸åŒé…ç½®ï¼Œä»¥é¿å…å„åº”ç”¨ä¹‹é—´å‘ç”Ÿkeyç¢°æ’ä¸è¦†ç›–
                        defaultExpireSecond:10*60   //å¯ç¼ºçœï¼Œclass2apiå†…éƒ¨çš„é»˜è®¤æ··å­˜æ—¶é•¿ä¸º1åˆ†é’Ÿï¼Œå¯è‡ªå®šä¹‰
                    })
```

- getRedisClient
è·å¾—redisè®¿é—®å®ä¾‹

- GKErrorWrap 
é”™è¯¯åŒ…è£…å™¨ï¼Œå½“é¢„è®¾é”™è¯¯ç±»å‹ä¸å¤Ÿç”¨æ—¶ï¼Œå¯è‡ªå®šä¹‰ã€‚æ³¨ï¼šclass2apiå†…ç½®çš„å¸¸è®¾é”™è¯¯çš„codeä¸ºè´Ÿæ•°é¢†åŸŸï¼Œå¤–éƒ¨è‡ªå®šä¹‰çš„é”™è¯¯ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨æ­£æ•°

- modelSetting 
ä¿®é¥°å™¨ï¼Œç±»æ¨¡å—çš„å…ƒä¿¡æ¯é…ç½®ç±»
```javascript
    @modelSetting({
        __Auth:async ({req})=>{
            //åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè§£æheaderä¸­çš„jwtokenä¿¡æ¯ï¼Œè°ƒç”¨class2api/rulehelperçš„è§£æï¼Œæ³¨æ„ä¸éåå°å¸¸è§„ç”¨æˆ·éªŒè¯çš„åŒºåˆ«
            let jwtoken = req.header('jwtoken') || ''
            return await parseAdminAccountFromJWToken({jwtoken})
        },
        //åå°æƒé™è®¤è¯çš„ç»„ä¿¡æ¯
        __ruleCategory: {
            name: 'æ–‡ç« ç³»ç»Ÿ',
            desc: 'æ–‡ç« ç³»ç»Ÿ'
        }
    })
    class GKModelA {
        constructor() {
            throw 'é™æ€ä¸šåŠ¡åŠŸèƒ½ç±»æ— æ³•å®ä¾‹åŒ–'
        }
    }
```

- cacheAble    
ä¿®é¥°å™¨,å¯ç”¨ç±»æ–¹æ³•è°ƒç”¨ç¼“å­˜çš„ä¿®é¥°å™¨

- clearCache   
ä¿®é¥°å™¨,æ¸…ç©ºç±»æ–¹æ³•è°ƒç”¨ç¼“å­˜çš„ä¿®æ—¶å™¨

- accessRule   
ä¿®é¥°å™¨,æä¾›è®¿é—®æƒé™çš„æ ¡éªŒæ§åˆ¶,å¯ç‹¬ç«‹é…ç½®è®¤è¯å‡½æ•°
- setting_RuleValidator  accessRuleè®¿é—®æƒé™ä¿®é¥°å™¨ä¸­è®¤è¯å‡½æ•°çš„å…¨å±€é…ç½®å…¥å£
- crashAfterMe  ä¿®é¥°å™¨,è¿è¡Œå®Œç±»æ–¹æ³•å°±è®¤ä¸ºè·‘å‡ºå¼‚å¸¸ä¸­æ–­ç¨‹åºï¼Œè°ƒè¯•ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹è‡ªåŠ¨å¤±æ•ˆ

class2api/gkerrors
- GKErrors  å¸¸ç”¨é¢„è®¾çš„é”™è¯¯ï¼ˆcodeä¸ºè´Ÿæ•°ï¼‰

class2api/dbhelper
- TableSetting  sequelizeModelå®šä¹‰modelæ—¶çš„æ‰©å±•é…ç½®
- ResetDB   é‡ç½®æ•°æ®åº“
- DBModelLoader åŠ è½½Modelå®šä¹‰æ–‡ä»¶
- DBUtils   æ•°æ®åº“çš„è¾…åŠ©å·¥å…·æ–¹æ³•
- fn        sequezeliçš„èšåˆå‡½æ•°å¼•ç”¨
- col       sequezeliçš„åˆ—å¼•ç”¨å‡½æ•°
- literal   sqlè¯­å¥å­—é¢é‡åŒ…è£…å‡½æ•°ï¼Œç¡®ä¿sequelizeä¸è§£ææ­¤SQLå­—ç¬¦ä¸²
- where     sequezeliçš„whereå¼•ç”¨å‡½æ•°
- createTransaction åˆ›å»ºä¸€ä¸ªsequezeliäº‹åŠ¡
- excuteSQL æ‰§è¡ŒæŒ‡å®šçš„SQLè¯­å¥ï¼Œä¸€èˆ¬é€‚ç”¨äºæ— æ³•ç”¨sequelizeè¡¨è¾¾å¼çš„å¤æ‚æŸ¥è¯¢

class2api/testhelper
- setApiRoot    å¾®æœåŠ¡APIçš„domain
- WebInvokeHepler(usertoken)(apiPath, postParams, apiDesc)      å‘apiå‘èµ·ä¸€ä¸ªpost-APIè¯·æ±‚ï¼Œ postParamsæ˜¯postçš„JSONå†…å®¹ï¼ŒapiDescæ˜¯APIæ–¹æ³•æè¿°çš„å‡½æ•°å°è£…ï¼ˆåªæ˜¯æé«˜å¯è¯»æ€§ï¼Œæ²¡æœ‰å®é™…åŠŸèƒ½æ„ä¹‰ï¼‰
- ApiDesc       APIæ–¹æ³•æè¿°çš„å‡½æ•°å°è£…ï¼Œåªæ˜¯æé«˜åœ¨çœŸå®å…¥å‚åˆ—è¡¨ä¸­çš„å¯è¯»æ€§ï¼Œæ²¡æœ‰å®é™…åŠŸèƒ½æ„ä¹‰
- save2Doc      ä¿å­˜æœ¬æ¬¡mochaç”¨ä¾‹ä¸­æ‰€æœ‰æä¾›äº†ApiDescå‚æ•°çš„APIè¯·æ±‚çš„å…¥å‚ä¸è¿”å›ç»“æœ


$ npm publish --registry=http://registry.npmjs.org  --  



